





<!-- Определение вхождения адреса доставки в зону доставки + карта / ЧАСТЬ 1 -->



<!-- Интегригруем тултипы -->
<!-- Development -->
<script src="https://unpkg.com/@popperjs/core@2/dist/umd/popper.min.js"></script>
<script src="https://unpkg.com/tippy.js@6/dist/tippy-bundle.umd.js"></script>
<!-- Production -->
<script src="https://unpkg.com/@popperjs/core@2"></script>
<script src="https://unpkg.com/tippy.js@6"></script>
<link  rel="stylesheet"  href="https://unpkg.com/tippy.js@6/animations/scale.css"/>
<!-- Интегригруем тултипы -->

<script type="text/javascript" src="https://api-maps.yandex.ru/2.1/?lang=ru_RU&coordorder=longlat&apikey=4d7c41f5-5a3a-4bbb-94a1-08030c5f96b8"></script>
<script type="text/javascript" src="https://yandex.st/jquery/2.2.3/jquery.js"></script>
<div class="t-container"><div class="t-col t-col_12"><div id="map__0" style="height:678px; border-radius: 30px;"></div></div></div>
<style>
			#map__0 {
			width: 100%;
			height: 678px;
			padding: 0;
			margin: 0;
			border-radius: 30px;

		}
   
   .tippy-tooltip.tomato-theme {
		background-color: tomato;
		color: white;
	}
	.tippy-tooltip.black-theme {
		background-color: black;
		color: white;
	}
</style>

<script>

$.getScript( "https://morda-boy.github.io/qwer-delievery-v2.js" )
//$.getScript( "https://hitag.ru/files/hongkong/qwer-delievery.js" )


  .done(function( script, textStatus ) {
	//console.log( textStatus );
	console.log( "delievery ok");
  })
  .fail(function( jqxhr, settings, exception ) {
	//$( "div.log" ).text( "Triggered ajaxError handler." );
	console.log( "delievery download fail");
});
//Пробуем изменить доставку
(function () {

console.log('---))))))у');

    //Название скидки в системе
    let dnDelivery = 'Самовывоз 10%';
    //Название доставки в корзине
    let cartNameDelivery = 'Самовывоз';
        //Подпись для подсказки в корзине
    let discountHint = 'Скидка за самовывоз 10%';
    let discount = 0;

	//Функция, которая отключает скидку за самовывоз.

    function unactivePickup(){
        let newDiscount = [];
        
        for (let key in discount) {
            if( discount[key].name != dnDelivery   ) newDiscount.push(discount[key]);
        };
        
        t_cart__discounts = newDiscount;
        updateDicoutns();

    };
//Противоположная функция: включает скидку за самовывоз.
	function activePickup(){
        t_cart__discounts = discount;
        updateDicoutns();
    };

//Эта функция перерисовывает корзину, пересчитывает общую сумму и сохраняет изменения.
    function updateDicoutns(){
        tcart__updateTotalProductsinCartObj(),tcart__reDrawTotal(),tcart__saveLocalObj();
    };

	//Немного ждем, чтобы корзина успела загрузиться.

    setTimeout(function () {
		console.log('--==+==---');

        let discountAwait = setInterval(function() {
            if ( window.t_cart__discounts !== void 0  ){
                clearInterval(discountAwait) 
                discount = t_cart__discounts;
                console.log(discount);
            }
        }, 100);   
		console.log('discount');

		console.log(discount);


        let tcartAwait = setInterval(function() {
			console.log(tcartAwait);
            let elem  = document.querySelector('.t706__cartwin-prodamount');
			console.log('elem');
			console.log(elem);

            if (elem !== void 0  ){
                clearInterval(tcartAwait) 

                let observer = new MutationObserver(mutationRecords => {
					console.log('Создаем наблюдатель за изменениями корзины.'); 
                    checkDelivery();
                });

                observer.observe(elem, {
                    childList: true, 
                    subtree: true, 
                    characterDataOldValue: true
                });     
            }
			console.log(' no elem');

        }, 100); 

    }, 1000); 

	//Главная функция: проверяет, выбран ли нужный способ доставки.

    let pickupOn = false;
    let firstOpen = true;
    function checkDelivery(){
		console.log('ХХХХХХХ');

        let deliveryName = document.querySelector('input.t-radio_delivery:checked');
	
		console.log(deliveryName);

        if(deliveryName==null) {
            deliveryName = 0;
        }else{
            deliveryName = deliveryName.value;
            deliveryName = deliveryName.trim()
			console.log(deliveryName);

        };
        
        if( deliveryName==cartNameDelivery  ){
            
            setTimeout(function() {
                let descr = document.querySelector('.t706__cartwin-discounts__description li');
                if(descr!=null){
                  descr.innerText = discountHint;
                };
            }, 500)
    
            if(!pickupOn){
                activePickup();
                pickupOn = true;
            };
            
        }else{
    
            if(pickupOn || firstOpen){
                unactivePickup();
                pickupOn = false;
                firstOpen = false;
            };
              
        };
	};

	})();




</script>








